<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Login</title>
<link rel="stylesheet" href="login.css">

<script>
// ğŸ” Se jÃ¡ estiver logado, redireciona
if (localStorage.getItem("token")) {
  const role = localStorage.getItem("role");
  if (role === "admin") {
    window.location.href = "admin.html";
  } else {
    window.location.href = "dashboard.html";
  }
}
</script>

<style>
.erro-animado {
  animation: shake 0.3s;
}

@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
  100% { transform: translateX(0); }
}
</style>
</head>

<body>

<main class="login-bg">
  <section class="login-card">

    <div class="logo">â†—</div>

    <h2>Bem-vindo!</h2>
    <p class="subtitle">FaÃ§a login para acessar o sistema</p>

    <div class="field">
      <label>UsuÃ¡rio</label>
      <input type="text" id="username" placeholder="Digite seu usuÃ¡rio">
    </div>

    <div class="field">
      <label>Senha</label>
      <div style="display:flex;">
        <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="flex:1;">
        <button type="button" onclick="toggleSenha()">ğŸ‘</button>
      </div>
    </div>

    <p id="erro" style="color:red; display:none;"></p>

    <button class="btn-login" id="btnLogin">
      Entrar no Sistema
    </button>

  </section>
</main>

<script>
const API = "https://sistema-gestao-yz16.onrender.com";
const btn = document.getElementById("btnLogin");
const erro = document.getElementById("erro");

function toggleSenha(){
  const input = document.getElementById("password");
  input.type = input.type === "password" ? "text" : "password";
}

// ğŸ” Login ao apertar ENTER
document.addEventListener("keypress", function(e){
  if(e.key === "Enter"){
    login();
  }
});

btn.addEventListener("click", login);

async function login() {

  btn.disabled = true;
  btn.innerText = "Entrando...";
  erro.style.display = "none";

  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  if (!username || !password) {
    mostrarErro("Preencha todos os campos");
    return;
  }

  try {
    const res = await fetch(API + "/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const data = await res.json();

    if (!res.ok) {
      mostrarErro(data.error || "Erro no login");
      return;
    }

    localStorage.setItem("token", data.token);
    localStorage.setItem("role", data.role);

    if (data.role === "admin") {
      window.location.href = "admin.html";
    } else {
      window.location.href = "dashboard.html";
    }

  } catch (err) {
    mostrarErro("Erro de conexÃ£o com servidor");
  }
}

function mostrarErro(msg){
  erro.innerText = msg;
  erro.style.display = "block";
  erro.classList.add("erro-animado");

  setTimeout(() => {
    erro.classList.remove("erro-animado");
  }, 300);

  btn.disabled = false;
  btn.innerText = "Entrar no Sistema";
}
</script>

</body>
</html>
