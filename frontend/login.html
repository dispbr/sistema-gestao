<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Login</title>
<link rel="stylesheet" href="login.css">
</head>
<body>

<main class="login-bg">
  <section class="login-card">

    <div class="logo">‚Üó</div>

    <h2>Bem-vindo!</h2>
    <p class="subtitle">Fa√ßa login para acessar o sistema</p>

    <div class="field">
      <label>Usu√°rio</label>
      <input type="text" id="username" placeholder="Digite seu usu√°rio">
    </div>

    <div class="field">
      <label>Senha</label>
      <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    </div>

    <p id="erro" style="color:red; display:none;"></p>

    <button class="btn-login" onclick="login()">
      Entrar no Sistema
    </button>

  </section>
</main>

<script>
const API = "https://sistema-gestao-yz16.onrender.com";

async function login() {

  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;
  const erro = document.getElementById("erro");

  erro.style.display = "none";

  try {
    const res = await fetch(API + "/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const data = await res.json();

    if (!res.ok) {
      erro.innerText = data.error || "Usu√°rio ou senha inv√°lidos";
      erro.style.display = "block";
      return;
    }

    // üîê Salva dados da sess√£o
    localStorage.setItem("token", data.token);
    localStorage.setItem("role", data.role);
    localStorage.setItem("username", username);

    // üî• SEMPRE abre sua dashboard antiga
    window.location.href = "dashboard.html";

  } catch (err) {
    erro.innerText = "Erro de conex√£o com o servidor";
    erro.style.display = "block";
  }
}
</script>

</body>
</html>
